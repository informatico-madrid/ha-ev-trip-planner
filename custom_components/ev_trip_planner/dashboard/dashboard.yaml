# Dashboard base para EV Trip Planner (ejemplo)
# Nota: ajusta los entity_id a los de tus sensores reales cuando integremos 1C en HA.
# Sugeridos (cuando se creen):
#  - sensor.chispitas_trips_list
#  - sensor.chispitas_recurring_trips_count
#  - sensor.chispitas_punctual_trips_count

views:
  - title: EV Trip Planner
    path: ev-trip-planner
    icon: mdi:car-electric
    cards:
      # Tarjeta de estado general
      - type: markdown
        title: ğŸ“Š Estado general
        content: |
          **VehÃ­culo:** Chispitas  
          **Viajes totales:** {{ states('sensor.chispitas_trips_list') }}  
          **Recurrentes activos:** {{ states('sensor.chispitas_recurring_trips_count') }}  
          **Puntuales pendientes:** {{ states('sensor.chispitas_punctual_trips_count') }}

      # Grid semanal de viajes recurrentes
      - type: markdown
        title: ğŸ“… Viajes recurrentes semanales
        content: |
          {% set trips = state_attr('sensor.chispitas_trips_list', 'trips') %}
          {% set days = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'] %}
          {% set day_names = {'lunes': 'Lunes', 'martes': 'Martes', 'miercoles': 'MiÃ©rcoles', 
                              'jueves': 'Jueves', 'viernes': 'Viernes', 'sabado': 'SÃ¡bado', 'domingo': 'Domingo'} %}
          
          {% if trips %}
            {% for day in days %}
              {% set day_trips = trips | selectattr('tipo', 'equalto', 'recurrente') | selectattr('dia_semana', 'equalto', day) | list %}
              {% if day_trips %}
          
          **{{ day_names[day] }}**
                {% for trip in day_trips %}
          - ğŸ• {{ trip.hora }} - {{ trip.km }} km / {{ trip.kwh }} kWh {% if not trip.activo %}*(pausado)*{% endif %}
                {% endfor %}
              {% endif %}
            {% endfor %}
          {% else %}
          *No hay viajes recurrentes configurados*
          {% endif %}
        card_mod:
          style: |
            ha-card {
              border-left: 4px solid var(--primary-color);
            }

      # Lista de viajes puntuales
      - type: markdown
        title: ğŸ¯ Viajes puntuales
        content: |
          {% set trips = state_attr('sensor.chispitas_trips_list', 'trips') %}
          {% set punctual = trips | selectattr('tipo', 'equalto', 'puntual') | list if trips else [] %}
          
          {% if punctual %}
            {% for trip in punctual | sort(attribute='datetime') %}
              {% set dt = trip.datetime | as_datetime %}
              {% set status_icon = {'pendiente': 'â³', 'completado': 'âœ…', 'cancelado': 'âŒ'} %}
          
          {{ status_icon.get(trip.estado, 'â“') }} **{{ dt.strftime('%d/%m/%Y %H:%M') if dt else trip.datetime }}**  
          {{ trip.km }} km / {{ trip.kwh }} kWh - *{{ trip.estado }}*
            {% endfor %}
          {% else %}
          *No hay viajes puntuales*
          {% endif %}
        card_mod:
          style: |
            ha-card {
              border-left: 4px solid var(--accent-color);
            }

      # Tarjeta de cÃ¡lculos del dÃ­a (Milestone 2)
      - type: markdown
        title: ğŸ“Š CÃ¡lculos del DÃ­a
        content: |
          **PrÃ³ximo viaje:** {{ states('sensor.chispitas_next_trip') }}
          **Fecha lÃ­mite:** {{ states('sensor.chispitas_next_deadline') }}
          **kWh necesarios hoy:** {{ states('sensor.chispitas_kwh_today') }} kWh
          **Horas de carga:** {{ states('sensor.chispitas_hours_today') }} h
          
          ---
          
          *CÃ¡lculos actualizados automÃ¡ticamente desde los viajes programados*

      # Tarjeta de estado del vehÃ­culo
      - type: markdown
        title: ğŸš— Estado del vehÃ­culo
        content: |
          **Viajes activos hoy:** -  *(prÃ³ximamente)*
          **PrÃ³ximo viaje:** {{ states('sensor.chispitas_next_trip') }}
          **kWh necesarios:** {{ states('sensor.chispitas_kwh_today') }} kWh
          **Horas de carga:** {{ states('sensor.chispitas_hours_today') }} h
          
          ---
          
          *Milestone 2 completado âœ…*

      - type: entities
        title: ğŸ“ˆ Contadores detallados
        entities:
          - entity: sensor.chispitas_recurring_trips_count
            name: Viajes recurrentes
            icon: mdi:calendar-repeat
          - entity: sensor.chispitas_punctual_trips_count
            name: Viajes puntuales
            icon: mdi:calendar-star
          - entity: sensor.chispitas_trips_list
            name: Total de viajes
            icon: mdi:format-list-numbered
